<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lion King London - Master Overview</title>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

<style>
body {
  font-family: 'Poppins', sans-serif;
  background: #f6f6f6;
  margin: 0;
}

/* ================= HEADER ================= */
#header {
  position: fixed;
  top: 0;
  left: 0;
  width: calc(100% - 40px);
  background: #fed004;
  z-index: 1000;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  padding: 10px 20px;
  text-align: center;
}

#header h1 {
  margin: 0;
  color: #660000;
  text-transform: uppercase;
}

#last-updated {
  font-size: 13px;
  font-weight: 500;
  color: #660000;
  opacity: 0.85;
  margin: 4px 0 8px;
}

/* ================= CONTROLS ================= */
#controls {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
}

#funnel-btn {
  background: #660000;
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  font-weight: 500;
  cursor: pointer;
  text-transform: uppercase;
}

#date-picker {
  font-family: 'Poppins', sans-serif;
  padding: 6px 8px;
  border-radius: 6px;
  border: 1px solid #660000;
}

/* ================= FUNNEL DROPDOWN ================= */
#toggles {
  position: fixed;
  top: 120px;
  left: 50%;
  transform: translateX(-50%);
  background: #fed004;
  padding: 12px 15px;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  width: 360px;
  justify-content: center;
  z-index: 1001;
}

#toggles.hidden { display:none; }

#toggles label {
  display: flex;
  align-items: center;
  font-weight: 500;
  cursor: pointer;
}

#toggles input { margin-right:5px; }

input[data-section="General"] + span { color:#ff7a00; }
input[data-section="Associate"] + span { color:#0077ff; }
input[data-section="Auditions"] + span { color:#28a745; }
input[data-section="Fittings"] + span { color:#6f42c1; }
input[data-section="Marketing"] + span { color:#dc3545; }
input[data-section="Operational"] + span { color:#434343; }

/* ================= CONTENT ================= */
#content {
  padding: 200px 20px 40px;
}

.month { margin-top:40px; }

.month h2 {
  position: sticky;
  top: 126px;
  background: #000;
  color: white;
  text-transform: uppercase;
  padding: 6px 12px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  z-index: 500;
}

.month h2 span { flex:1; text-align:center; }

.month-nav {
  background:none;
  border:none;
  color:white;
  font-size:18px;
  cursor:pointer;
}

/* ================= CALENDAR ================= */
.calendar {
  display: grid;
  grid-template-columns: repeat(7,1fr);
  gap:14px;
}

.day {
  background: white;
  border-radius: 14px;
  padding: 12px;
  box-shadow: 0 6px 16px rgba(0,0,0,0.08);
}

.day.has-data { border:3px solid #660000; }
.day.today { background:#fcefb8; border:3px solid #660000; }
.day.past { opacity:0.5; }
.day.selected { border:3px solid #28a745; }

.date {
  font-weight:600;
  margin-bottom:8px;
  text-transform:uppercase;
}

/* ================= COLUMN H ================= */
.top-notes {
  display:flex;
  gap:6px;
  margin-bottom:8px;
  flex-wrap:wrap;
}
.top-notes.placeholder { min-height:28px; }

.top-note {
  background:#fecf03;
  padding:4px 8px;
  border-radius:999px;
  font-size:13px;
  font-weight:500;
}

/* ================= SECTIONS ================= */
.section {
  margin-top:5px;
  border-radius:8px;
  padding:6px 8px;
  color:white;
  font-size:14px;
}
.section.collapsed { display:none; }

#Associate{background:#0077ff;}
#General{background:#ff7a00;}
#Auditions{background:#28a745;}
#Fittings{background:#6f42c1;}
#Marketing{background:#dc3545;}
#Operational{background:#434343;}

.empty { visibility:hidden; }

/* ================= FLOATING TODAY ================= */
#jump-today {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: #660000;
  color: white;
  border: none;
  padding: 10px 14px;
  border-radius: 999px;
  font-family: 'Poppins', sans-serif;
  font-weight: 500;
  cursor: pointer;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
}

#jump-today.show {
  opacity: 1;
  pointer-events: auto;
}

/* ================= MOBILE ================= */
@media (max-width:768px){
  .calendar{grid-template-columns:1fr;}
  .empty{display:none;}
  #header h1 {font-size: 17px;}
  .month h2 {top: 104px; font-size: 20px;}
}
</style>
</head>
<body>

<div id="header">
  <h1>Lion King London - Master Overview</h1>
  <div id="last-updated"></div>

  <div id="controls">
    <button id="funnel-btn">SELECT DATE OR FUNNEL ITEMS ▼</button>
  </div>
</div>

<div id="toggles" class="hidden">
  <label style="width:100%; text-align:center;">
  <span style="font-weight:600; margin-right:6px;justify-content: center;">Jump to date</span>
  <input type="date" id="date-picker">
</label>
  <label><input type="checkbox" class="section-toggle" data-section="Associate" checked><span>Associate Visits</span></label>
  <label><input type="checkbox" class="section-toggle" data-section="General" checked><span>General</span></label>
  <label><input type="checkbox" class="section-toggle" data-section="Auditions" checked><span>Auditions</span></label>
  <label><input type="checkbox" class="section-toggle" data-section="Fittings" checked><span>Fittings</span></label>
  <label><input type="checkbox" class="section-toggle" data-section="Marketing" checked><span>Marketing</span></label>
  <label><input type="checkbox" class="section-toggle" data-section="Operational" checked><span>Operational</span></label>
</div>

<div id="content"><div id="output"></div></div>
<button id="jump-today">Jump to Today</button>

<script>
const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQTMDvB8kywSPPVGastAuRAoTEXziTCcfG-2wD2AJ7dUuYGreBjhGT8iawSsIyc4jTW6gUef0vvLh-X/pub?gid=906067235&single=true&output=csv";

const SECTIONS = [
  {col:6,id:"Associate"},
  {col:1,id:"General"},
  {col:2,id:"Auditions"},
  {col:3,id:"Fittings"},
  {col:4,id:"Marketing"},
  {col:5,id:"Operational"}
];

function ordinal(n){
  if(n>3&&n<21)return n+"th";
  return n%10==1?n+"st":n%10==2?n+"nd":n%10==3?n+"rd":n+"th";
}

Papa.parse(SHEET_URL,{
  download:true,
  complete(res){
    const rows=res.data;
    if(rows[0]?.[8]) document.getElementById("last-updated").textContent=rows[0][8];

    const today=new Date(); today.setHours(0,0,0,0);
    const first=new Date(today.getFullYear(),today.getMonth(),1);
    const out=document.getElementById("output");
    let currentMonth="",calendar,todayEl;

    rows.slice(3).forEach(r=>{
      const d=new Date(r[0]); if(isNaN(d)||d<first)return;
      d.setHours(0,0,0,0);
      const label=d.toLocaleDateString(undefined,{month:"long",year:"numeric"});

      if(label!==currentMonth){
        currentMonth=label;
        const m=document.createElement("div");
        m.className="month";
        m.innerHTML=`<h2>
          <button class="month-nav prev">◀</button>
          <span>${label}</span>
          <button class="month-nav next">▶</button>
        </h2><div class="calendar"></div>`;
        out.appendChild(m);
        calendar=m.querySelector(".calendar");

        const offset=(d.getDay()+6)%7;
        for(let i=0;i<offset;i++)calendar.appendChild(Object.assign(document.createElement("div"),{className:"day empty"}));
      }

      const day=document.createElement("div");
      day.className="day";
      day.dataset.date=d.toISOString().split("T")[0];

      let html=`<div class="date">${d.toLocaleDateString(undefined,{weekday:"long"}).toUpperCase()} ${ordinal(d.getDate())}</div>`;

      if(r[7]){
        html+=`<div class="top-notes">${r[7].split("\n").map(n=>`<div class="top-note">${n}</div>`).join("")}</div>`;
      } else html+=`<div class="top-notes placeholder"></div>`;

      let has=false;
      SECTIONS.forEach(s=>{
        if(r[s.col]){
          has=true;
          r[s.col].split("\n").forEach(line=>{
            if(line.trim()) html+=`<div class="section" id="${s.id}">${line}</div>`;
          });
        }
      });

      if(has)day.classList.add("has-data");
      if(+d===+today){day.classList.add("today");todayEl=day;}
      if(d<today)day.classList.add("past");

      day.innerHTML=html;
      calendar.appendChild(day);
    });

    /* Auto jump to today */
    if(todayEl){
      const y=todayEl.getBoundingClientRect().top+window.scrollY-document.getElementById("header").offsetHeight-50;
      window.scrollTo({top:y,behavior:"instant"});
    }

    /* Toggles */
    document.querySelectorAll(".section-toggle").forEach(t=>{
      t.onchange=e=>{
        document.querySelectorAll(`#${e.target.dataset.section}`)
          .forEach(el=>el.classList.toggle("collapsed",!e.target.checked));
      };
    });

    /* Month arrows */
    document.addEventListener("click",e=>{
      if(!e.target.classList.contains("month-nav"))return;
      const headers=[...document.querySelectorAll(".month h2")];
      const h=e.target.closest("h2");
      const i=headers.indexOf(h);
      const target=e.target.classList.contains("prev")?headers[i-1]:headers[i+1];
      if(target)target.scrollIntoView({behavior:"smooth",block:"start"});
    });

    /* Date picker */
   document.getElementById("date-picker").onchange = e => {
  document.querySelectorAll(".day").forEach(d => d.classList.remove("selected"));

  const target = document.querySelector(`.day[data-date="${e.target.value}"]`);
  if (!target) return;

  target.classList.add("selected");

  const headerHeight = document.getElementById("header").offsetHeight;
  const monthHeader = target.closest(".month")?.querySelector("h2");
  const monthHeight = monthHeader ? monthHeader.offsetHeight : -50;

  const y =
    target.getBoundingClientRect().top +
    window.pageYOffset -
    headerHeight -
    monthHeight -
    10;

  window.scrollTo({
    top: y,
    behavior: "smooth"
  });
};

    /* Floating today button */
    const jump=document.getElementById("jump-today");
    jump.onclick=()=>todayEl.scrollIntoView({behavior:"smooth",block:"start"});
    window.addEventListener("scroll",()=>{
      jump.classList.toggle("show",Math.abs(todayEl.getBoundingClientRect().top)>250);
    });
  }
});

/* Funnel */
document.getElementById("funnel-btn").onclick=()=>document.getElementById("toggles").classList.toggle("hidden");
</script>
</body>
</html>
